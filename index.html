<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor Basado en Evidencia - Espasticidad</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
        }
        .dashboard-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 500px;
        }
        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        p.subtitle {
            text-align: center;
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #34495e;
            font-size: 14px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccd1d9;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 15px;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background-color: #004494;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-left: 5px solid #0056b3;
            border-radius: 4px;
            text-align: center;
        }
        .result-box h3 {
            margin: 10px 0 0 0;
            color: #0056b3;
            font-size: 28px;
        }
        .reference {
            font-size: 11px;
            color: #95a5a6;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="dashboard-container">
    <h2>Calculadora de Riesgo NAbs</h2>
    <p class="subtitle">Modelo de regresión logística (basado en Metaanálisis)</p>

    <div class="form-group">
        <label for="historial">Historial de tratamiento:</label>
        <select id="historial" onchange="calcularRiesgoLogistico()">
            <option value="naive">Paciente Naïve (1ª Dosis)</option>
            <option value="dosis2">2ª Dosis</option>
            <option value="dosis3">3ª Dosis</option>
            <option value="dosis4">4ª Dosis</option>
            <option value="cronico" selected>Tratamiento crónico (> 2 años)</option>
        </select>
    </div>

    <div class="form-group">
        <label for="formulacion">Formulación (BoNT-A):</label>
        <select id="formulacion" onchange="calcularRiesgoLogistico()">
            <option value="INCO">IncobotulinumtoxinA</option>
            <option value="ONA" selected>OnabotulinumtoxinA</option>
            <option value="ABO">AbobotulinumtoxinA</option>
        </select>
    </div>

    <div class="form-group">
        <label for="dosis">Dosis total estimada (Unidades):</label>
        <input type="number" id="dosis" min="10" max="2500" value="400" oninput="calcularRiesgoLogistico()">
    </div>

    <div class="form-group">
        <label for="frecuencia">Intervalo de tratamiento (semanas):</label>
        <input type="number" id="frecuencia" min="2" max="24" value="12" oninput="calcularRiesgoLogistico()">
    </div>

    <button onclick="calcularRiesgoLogistico()">Calcular probabilidad absoluta</button>

    <div id="resultado" class="result-box">
        <p style="margin:0; font-size:14px; color:#333;">Probabilidad Clínica Estimada:</p>
        <h3 id="probabilidad-texto">0.00%</h3>
    </div>

    <p class="reference">Base poblacional: Pacientes con espasticidad. Riesgo base calibrado a ~1.4% en pacientes crónicos a 400U. Modelo ajustado mediante Odds Ratios derivados de revisión de literatura científica (escala de dosis continua).</p>
</div>

<script>
    // Ejecutar el cálculo una vez al cargar la página
    window.onload = function() {
        calcularRiesgoLogistico();
    };

    function calcularRiesgoLogistico() {
        const historial = document.getElementById('historial').value;
        const formulacion = document.getElementById('formulacion').value;
        const dosis = parseFloat(document.getElementById('dosis').value) || 0;
        const semanas = parseFloat(document.getElementById('frecuencia').value) || 12;

        // 1. Probabilidad matemática pura muy baja que servirá de anclaje (0.5%)
        const baseProb = 0.005; 
        let odds = baseProb / (1 - baseProb);

        // 2. OR Historial (Exposición inmunológica)
        let orHistorial = 1.0;
        if (historial === 'naive') orHistorial = 0.05;      // Riesgo virtualmente nulo en 1ª dosis
        else if (historial === 'dosis2') orHistorial = 0.5; // Comienza la respuesta adaptativa
        else if (historial === 'dosis3') orHistorial = 0.8; 
        else if (historial === 'dosis4') orHistorial = 1.2;
        else if (historial === 'cronico') orHistorial = 1.8; // Mayor exposición acumulada

        // 3. OR Formulación
        let orFormulacion = 1.0; // ONA por defecto
        if (formulacion === 'INCO') orFormulacion = 0.05; // Protección por ausencia de proteínas complejas
        if (formulacion === 'ABO') orFormulacion = 1.2;   // Ligeramente más inmunogénico por carga proteica

        // 4. OR Frecuencia (Refuerzos < 12 semanas)
        let orFrecuencia = (semanas < 12) ? 3.5 : 1.0;

        // 5. OR Dosis (NUEVO: Escala continua exponencial)
        // Por cada 100 unidades, el OR se multiplica por ~1.12 (aumenta un 12%)
        let orDosis = Math.pow(1.12, (dosis / 100));

        // 6. Ecuación de Regresión Logística Final
        let oddsFinal = odds * orHistorial * orFormulacion * orFrecuencia * orDosis;
        
        // 7. Convertir de nuevo a Probabilidad (%)
        let probabilidadFinal = (oddsFinal / (1 + oddsFinal)) * 100;

        // Mostrar resultado (ahora con 3 decimales para ver el movimiento fluido)
        document.getElementById('probabilidad-texto').innerText = probabilidadFinal.toFixed(3) + "%";
    }
</script>

</body>
</html>